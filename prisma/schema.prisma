// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String
  email         String    @unique
  emailVerified DateTime?
  password      String
  image         String?
  role          String      @default("VISITOR") // Enum removed
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  accounts      Account[]
  sessions      Session[]
  membership    Membership?
  reservations  BoatReservation[]
  trainingSessions TrainingAttendance[]
  payments      Payment[]
  votes         Vote[]
  forumPosts    ForumPost[]
  forumComments ForumComment[]
  auditLogs     AuditLog[]
  competitionRegistrations CompetitionRegistration[]
  
  // Gamification
  points        Int             @default(0)
  level         Int             @default(1)
  badges        UserBadge[]
  activityLogs  ActivityLog[]
  
  // Store
  orders        Order[]
  
  // Tides & Weather
  tideAlerts    TideAlert[]
  
  // Notifications
  notifications Notification[]
  
  // Events
  rsvps         EventRSVP[]
  
  // Ranking & Performance
  performanceRecords PerformanceRecord[]
  socialActions      UserSocialAction[]
  anamnese           AnamneseForm?
  
  // Treinos
  workoutTemplatesCreated WorkoutTemplate[] @relation("WorkoutTemplateCreator")
  workoutSessions         WorkoutSession[]  @relation("WorkoutSessions")
  
  // Garagem
  resourceReservations    Reservation[]     @relation("Reservations")
  waitlistEntries         WaitlistEntry[]   @relation("WaitlistEntries")
  maintenanceReported     MaintenanceTicket[] @relation("MaintenanceReporter")
  maintenanceAssigned     MaintenanceTicket[] @relation("MaintenanceAssignee")
  
  // Voluntariado Expandido
  volunteerTasksAssigned  VolunteerTask[]   @relation("TasksAssigned")
  volunteerTasksCreated   VolunteerTask[]   @relation("TasksCreated")
  volunteerTasksReviewed  VolunteerTask[]   @relation("TasksReviewed")
  volunteerAvailability   VolunteerAvailability[] @relation("VolunteerAvailability")
  volunteerReputation     VolunteerReputation? @relation("VolunteerReputation")
  volunteerTalent         VolunteerTalent?  @relation("VolunteerTalent")

  // Controle de Voluntariado
  isVolunteer             Boolean           @default(false)
  volunteerSince          DateTime?
  volunteerTermAcceptance VolunteerTermAcceptance?
  
  // Progressão de Barcos
  boatUnlocks             UserBoatUnlock[]

  @@map("users")

}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? 
  access_token      String? 
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? 
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Membership {
  id              String           @id @default(cuid())
  userId          String           @unique
  membershipType  MembershipType   @relation(fields: [membershipTypeId], references: [id])
  membershipTypeId String
  status          String           @default("PENDING") // Enum removed
  startDate       DateTime         @default(now())
  endDate         DateTime?
  memberNumber    String           @unique
  qrCode          String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("memberships")
}

model MembershipType {
  id          String   @id @default(cuid())
  name        String
  description String?
  monthlyFee  Float
  benefits    String   @default("[]") // SQLite: JSON stringified
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  memberships Membership[]

  @@map("membership_types")
}

model Boat {
  id           String       @id @default(cuid())
  name         String
  type         String      // Enum removed
  status       String   @default("AVAILABLE") // Enum removed
  capacity     Int
  description  String?
  imageUrl     String?
  serialNumber String?      @unique
  purchaseDate DateTime?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  reservations  BoatReservation[]
  maintenances  BoatMaintenance[]

  @@map("boats")
}

model BoatReservation {
  id              String            @id @default(cuid())
  boatId          String
  userId          String
  startTime       DateTime
  endTime         DateTime
  status          String            @default("PENDING") // Enum removed
  checkInPhoto    String?
  checkOutPhoto   String?
  checkInTime     DateTime?
  checkOutTime    DateTime?
  notes           String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  boat Boat @relation(fields: [boatId], references: [id])
  user User @relation(fields: [userId], references: [id])

  @@map("boat_reservations")
}

model BoatMaintenance {
  id          String   @id @default(cuid())
  boatId      String
  description String
  cost        Float?
  startDate   DateTime
  endDate     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  boat Boat @relation(fields: [boatId], references: [id])

  @@map("boat_maintenances")
}

model Training {
  id          String   @id @default(cuid())
  title       String
  description String?
  coachName   String
  startTime   DateTime
  endTime     DateTime
  maxParticipants Int?
  location    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sessions TrainingAttendance[]

  @@map("trainings")
}

model TrainingAttendance {
  id         String   @id @default(cuid())
  trainingId String
  userId     String
  attended   Boolean  @default(false)
  notes      String?
  createdAt  DateTime @default(now())

  training Training @relation(fields: [trainingId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@unique([trainingId, userId])
  @@map("training_attendances")
}

model Competition {
  id          String   @id @default(cuid())
  name        String
  description String?
  location    String
  startDate   DateTime
  endDate     DateTime
  imageUrl    String?
  isPublic    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  registrations CompetitionRegistration[]

  @@map("competitions")
}

model CompetitionRegistration {
  id            String   @id @default(cuid())
  competitionId String
  userId        String
  category      String?
  notes         String?
  createdAt     DateTime @default(now())

  competition Competition @relation(fields: [competitionId], references: [id])
  user        User        @relation(fields: [userId], references: [id])

  @@unique([competitionId, userId])
  @@map("competition_registrations")
}

model Payment {
  id            String        @id @default(cuid())
  userId        String
  amount        Float
  description   String
  status        String        @default("PENDING") // Enum removed
  method        String        @default("PIX") // Enum removed
  pixQrCode     String?
  pixCopyPaste  String?
  dueDate       DateTime
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  user User @relation(fields: [userId], references: [id])
  order Order?

  @@map("payments")
}

model Election {
  id          String   @id @default(cuid())
  title       String
  description String?
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  candidates ElectionCandidate[]
  votes      Vote[]

  @@map("elections")
}

model ElectionCandidate {
  id          String   @id @default(cuid())
  electionId  String
  name        String
  position    String
  bio         String?
  photoUrl    String?
  createdAt   DateTime @default(now())

  election Election @relation(fields: [electionId], references: [id])
  votes    Vote[]

  @@map("election_candidates")
}

model Vote {
  id          String   @id @default(cuid())
  electionId  String
  candidateId String
  userId      String
  createdAt   DateTime @default(now())

  election  Election          @relation(fields: [electionId], references: [id])
  candidate ElectionCandidate @relation(fields: [candidateId], references: [id])
  user      User              @relation(fields: [userId], references: [id])

  @@unique([electionId, userId])
  @@map("votes")
}

model News {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  content     String   
  excerpt     String?
  imageUrl    String?
  authorName  String
  isPublished Boolean  @default(false)
  publishedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("news")
}

model ForumPost {
  id        String   @id @default(cuid())
  userId    String
  title     String
  content   String   
  isPinned  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User           @relation(fields: [userId], references: [id])
  comments ForumComment[]

  @@map("forum_posts")
}

model ForumComment {
  id        String   @id @default(cuid())
  postId    String
  userId    String
  content   String   
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post ForumPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User      @relation(fields: [userId], references: [id])

  @@map("forum_comments")
}

model Document {
  id          String   @id @default(cuid())
  title       String
  description String?
  fileUrl     String
  category    String
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("documents")
}

model Gallery {
  id          String   @id @default(cuid())
  title       String
  description String?
  imageUrl    String
  category    String?
  createdAt   DateTime @default(now())

  @@map("gallery")
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String?
  action    String
  entity    String
  entityId  String?
  details   String? // JSON changed to String
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())

  user User? @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

// --- STORE ---

model Product {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Float
  stock       Int      @default(0)
  images      String   @default("[]") // SQLite: JSON stringified
  categoryId  String?
  category    Category? @relation(fields: [categoryId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  orderItems  OrderItem[]

  @@map("products")
}

model Category {
  id          String   @id @default(cuid())
  name        String
  description String?
  products    Product[]

  @@map("categories")
}

model Order {
  id          String      @id @default(cuid())
  userId      String
  status      String      @default("PENDING") // Enum removed
  total       Float
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  user        User        @relation(fields: [userId], references: [id])
  items       OrderItem[]
  payment     Payment?    @relation(fields: [paymentId], references: [id])
  paymentId   String?     @unique

  @@map("orders")
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Float
  
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

// --- GAMIFICATION ---

model Badge {
  id          String   @id @default(cuid())
  name        String
  description String
  imageUrl    String
  condition   String?
  createdAt   DateTime @default(now())
  
  users       UserBadge[]

  @@map("badges")
}

model UserBadge {
  id        String   @id @default(cuid())
  userId    String
  badgeId   String
  awardedAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id])
  badge     Badge    @relation(fields: [badgeId], references: [id])

  @@unique([userId, badgeId])
  @@map("user_badges")
}

// --- CRM ---

model Lead {
  id          String     @id @default(cuid())
  name        String
  email       String
  phone       String?
  source      String?
  status      String     @default("NEW") // Enum removed
  notes       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@map("leads")
}

model Goal {
  id          String   @id @default(cuid())
  title       String
  target      Float
  current     Float    @default(0)
  deadline    DateTime
  type        String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("goals")
}

// --- TIDES & WEATHER SYSTEM ---

model TideData {
  id              String   @id @default(cuid())
  date            DateTime
  location        String   @default("Natal-RN")
  
  // Marés
  highTide1Time   String?
  highTide1Height Float?
  highTide2Time   String?
  highTide2Height Float?
  lowTide1Time    String?
  lowTide1Height  Float?
  lowTide2Time    String?
  lowTide2Height  Float?
  
  // Coeficiente
  coefficient     Int      // 0-100
  
  // Astronômico
  sunrise         String
  sunset          String
  moonrise        String?
  moonset         String?
  moonPhase       String   // "NEW", "FIRST_QUARTER", "FULL", "LAST_QUARTER"
  moonIllumination Float   // 0-100%
  
  // Melhor horário para remar
  bestRowingTime  String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([date, location])
  @@map("tide_data")
}

model WeatherData {
  id              String   @id @default(cuid())
  datetime        DateTime
  location        String   @default("Natal-RN")
  
  // Temperatura
  temperature     Float
  feelsLike       Float
  tempMin         Float
  tempMax         Float
  
  // Atmosférico
  humidity        Int      // %
  pressure        Float    // hPa
  visibility      Int      // metros
  uvIndex         Int      // 0-11+
  
  // Precipitação
  precipitation   Float    // mm
  precipProb      Int      // %
  cloudCover      Int      // %
  
  // Vento
  windSpeed       Float    // km/h
  windGust        Float?   // km/h
  windDirection   Int      // graus
  windDirText     String   // "N", "NE", "E", etc
  
  // Condições
  condition       String   // "clear", "cloudy", "rain", etc
  conditionText   String   // "Céu limpo", "Nublado", etc
  icon            String   // código ícone
  
  createdAt       DateTime @default(now())
  
  @@index([datetime])
  @@unique([datetime, location])
  @@map("weather_data")
}

model WaveData {
  id              String   @id @default(cuid())
  datetime        DateTime
  location        String   @default("Natal-RN")
  
  // Ondas
  waveHeight      Float    // metros
  wavePeriod      Float    // segundos
  waveDirection   Int      // graus
  waveDirText     String   // "NE", "E", etc
  
  // Água
  waterTemp       Float    // °C
  seaState        String   // "calm", "moderate", "rough", "very-rough"
  
  createdAt       DateTime @default(now())
  
  @@unique([datetime, location])
  @@map("wave_data")
}

model TideAlert {
  id          String   @id @default(cuid())
  userId      String
  alertType   String   // "IDEAL_CONDITIONS", "HIGH_TIDE", "LOW_TIDE"
  enabled     Boolean  @default(true)
  threshold   String?  // JSON string com condições específicas
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, alertType])
  @@map("tide_alerts")
}

// --- NOTIFICATIONS ---

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String   @default("INFO") // INFO, SUCCESS, WARNING, ERROR
  read      Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

// --- TECHNICAL INVENTORY ---

model InventoryItem {
  id              String   @id @default(cuid())
  name            String
  type            String   // Oar, Ergometer, Lifevest, etc.
  status          String   @default("OPERATIONAL") // OPERATIONAL, MAINTENANCE, RETIRED
  lastInspection  DateTime?
  nextMaintenance DateTime?
  usageHours      Float    @default(0)
  description     String?
  serialNumber    String?  @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("inventory_items")
}

// --- CLUB EVENTS & ASSEMBLIES ---

model ClubEvent {
  id          String   @id @default(cuid())
  title       String
  description String?
  date        DateTime
  location    String
  type        String   @default("SOCIAL") // SOCIAL, ASSEMBLY, CEREMONY
  imageUrl    String?
  maxCapacity Int?
  isPublic    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  rsvps       EventRSVP[]

  @@map("club_events")
}

model EventRSVP {
  id        String   @id @default(cuid())
  eventId   String
  userId    String
  status    String   @default("CONFIRMED")
  createdAt DateTime @default(now())

  event ClubEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@map("event_rsvps")
}

// --- SOCIAL RANKING & PERFORMANCE ---

model PerformanceRecord {
  id          String   @id @default(cuid())
  userId      String
  metric      String   // METERS_ROWED, ATTENDANCE, HEART_RATE
  value       Float
  date        DateTime @default(now())
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("performance_records")
}

model SocialAction {
  id          String   @id @default(cuid())
  title       String
  description String
  points      Int
  type        String   // VOLUNTEER, TASK, CAMPAIGN
  status      String   @default("ACTIVE")
  createdAt   DateTime @default(now())
  
  participants UserSocialAction[]

  @@map("social_actions")
}

model UserSocialAction {
  id             String   @id @default(cuid())
  userId         String
  socialActionId String
  completedAt    DateTime @default(now())
  
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  socialAction SocialAction @relation(fields: [socialActionId], references: [id], onDelete: Cascade)

  @@unique([userId, socialActionId])
  @@map("user_social_actions")
}
// Anamnese
model AnamneseForm {
  id              String   @id @default(cuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Etapa 1: Identificação
  fullName        String
  birthDate       DateTime
  cpf             String
  rg              String
  address         String
  city            String
  state           String
  zipCode         String
  phone           String
  emergencyContact String
  emergencyPhone   String
  emergencyRelation String
  
  // Etapa 2: Saúde
  bloodType       String?
  allergies       String?
  medications     String?
  healthConditions String?
  injuries        String?
  surgeries       String?
  weight          Float?
  height          Float?
  
  // Etapa 3: Atividade Física
  practicesSports Boolean  @default(false)
  whichSports     String?
  trainingFrequency String?
  rowingExperience  String? // Iniciante/Intermediário/Avançado
  
  // Etapa 4: Habilidades Náuticas (NOVO)
  canSwim         Boolean  @default(false)
  swimLevel       String?  // Basico/Intermediario/Avancado
  canBoardBoat    Boolean  @default(false)
  hasRowingLicense Boolean @default(false)
  licenseNumber   String?
  
  // Etapa 5: Objetivos
  goals           String
  availability    String?  // JSON de disponibilidade semanal

  
  // Metadata
  completedAt     DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("anamnese_forms")
}

// Gamification - Activity Log
model ActivityLog {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  activityType String  // ANAMNESE, VOLUNTEER, EAD_VIDEO, TRAINING, BOAT_RESERVATION, etc.
  description  String  // "Completou a Ficha de Anamnese"
  xpEarned     Int     // Pontos ganhos nesta atividade
  
  metadata     String? // JSON com dados extras (ex: videoId, trainingId)
  
  createdAt    DateTime @default(now())
  
  @@index([userId, createdAt])
  @@map("activity_logs")
}

// ════════════════════════════════════════════════════════════════
// MÓDULO DE TREINOS (WORKOUTS)
// ════════════════════════════════════════════════════════════════

// Planilhas de treino (criadas por COACH/BOARD)
model WorkoutTemplate {
  id              String   @id @default(cuid())
  title           String
  type            String   // TECHNIQUE, BASE, INTERVALS, RECOVERY, STRENGTH, INDOOR_TANK, INDOOR_GENERAL
  targetAudience  String   // JSON array de SkillLevel
  duration        Int      // minutos
  distance        Int?     // metros (opcional)
  
  // Etapas do treino
  stages          WorkoutStage[]
  
  // Criação e aprovação
  createdById     String
  createdBy       User     @relation("WorkoutTemplateCreator", fields: [createdById], references: [id])
  status          String   @default("APPROVED") // SUGGESTED, PENDING_APPROVAL, APPROVED, ARCHIVED
  
  // Sessões baseadas neste template
  sessions        WorkoutSession[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([type])
  @@index([status])
  @@map("workout_templates")
}

// Etapas de um treino
model WorkoutStage {
  id              String   @id @default(cuid())
  templateId      String
  template        WorkoutTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  
  order           Int      // Ordem da etapa
  name            String   // "Aquecimento", "Série Principal", "Desaquecimento"
  duration        Int      // minutos
  intensity       String   // EASY, MODERATE, HARD, MAX
  instructions    String
  targetPace      String?  // "2:00/500m"
  targetSPM       Int?     // strokes per minute
  
  @@index([templateId, order])
  @@map("workout_stages")
}

// Sessões de treino executadas
model WorkoutSession {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation("WorkoutSessions", fields: [userId], references: [id], onDelete: Cascade)
  
  templateId      String?
  template        WorkoutTemplate? @relation(fields: [templateId], references: [id])
  
  mode            String   // OUTDOOR, INDOOR_TANK, INDOOR_GENERAL
  status          String   // IN_PROGRESS, COMPLETED, CANCELLED
  
  // Timing
  startedAt       DateTime
  completedAt     DateTime?
  duration        Int?     // segundos
  
  // Métricas
  distance        Float?   // metros
  avgPace         String?  // "2:05/500m"
  avgSPM          Int?
  calories        Int?
  
  // GPS Track (se outdoor)
  gpsTrackPoints  GPSTrackPoint[]
  
  // Checklist pós-treino (se outdoor com barco)
  boatStored      Boolean  @default(false)
  boatWashed      Boolean  @default(false)
  damageReported  Boolean  @default(false)
  damageDetails   String?  // JSON
  
  // Gamificação
  pointsEarned    Int      @default(0)
  
  // Metadata
  metadata        String?  // JSON
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([userId, startedAt])
  @@index([status])
  @@index([mode])
  @@map("workout_sessions")
}

// Pontos GPS coletados durante treino outdoor
model GPSTrackPoint {
  id              String   @id @default(cuid())
  sessionId       String
  session         WorkoutSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  lat             Float
  lng             Float
  timestamp       String   // ISO timestamp
  accuracy        Float    // metros
  altitude        Float?
  speed           Float?   // m/s
  heading         Float?   // graus
  
  @@index([sessionId, timestamp])
  @@map("gps_track_points")
}

// ════════════════════════════════════════════════════════════════
// MÓDULO DE GARAGEM (RECURSOS E RESERVAS)
// ════════════════════════════════════════════════════════════════

// Recursos (barcos + tanque)
model Resource {
  id              String   @id @default(cuid())
  name            String
  type            String   // BOAT, TANK
  status          String   @default("AVAILABLE") // AVAILABLE, RESERVED, IN_USE, OVERDUE, MAINTENANCE, BLOCKED
  category        String?  // "Single", "Double", "Quad", "Eight"
  description     String
  imageUrl        String?
  
  // Regras de acesso (JSON)
  rules           String?  // JSON: { minRole, minSkillLevel, maxDuration, minTankWorkoutsCompleted, requiresApproval }
  
  // Localização
  location        String   // "Garagem Principal", "Área Indoor"
  
  // Manutenção
  lastMaintenanceAt   DateTime?
  nextMaintenanceAt   DateTime?
  usageCount          Int      @default(0)
  
  // Relacionamentos
  reservations    Reservation[]
  waitlist        WaitlistEntry[]
  maintenanceTickets MaintenanceTicket[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([type])
  @@index([status])
  @@map("resources")
}

// Reservas de recursos
model Reservation {
  id              String   @id @default(cuid())
  resourceId      String
  resource        Resource @relation(fields: [resourceId], references: [id])
  userId          String
  user            User     @relation("Reservations", fields: [userId], references: [id], onDelete: Cascade)
  
  status          String   // PENDING, CONFIRMED, IN_USE, COMPLETED, CANCELLED, OVERDUE
  
  // Horários
  startAt         DateTime
  expectedEndAt   DateTime
  actualStartAt   DateTime?
  actualEndAt     DateTime?
  
  // Checklist pós-uso
  stored          Boolean  @default(false)
  washed          Boolean  @default(false)
  damageReported  Boolean  @default(false)
  damageDetails   String?  // JSON
  
  // Metadata
  notes           String?
  pointsEarned    Int      @default(0)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([resourceId, startAt])
  @@index([userId])
  @@index([status])
  @@map("reservations")
}

// Fila de espera para recursos
model WaitlistEntry {
  id              String   @id @default(cuid())
  resourceId      String
  resource        Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  userId          String
  user            User     @relation("WaitlistEntries", fields: [userId], references: [id], onDelete: Cascade)
  
  position        Int      // Posição na fila
  interestedFrom  DateTime
  interestedUntil DateTime?
  notified        Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  
  @@index([resourceId, position])
  @@index([userId])
  @@map("waitlist_entries")
}

// Tickets de manutenção
model MaintenanceTicket {
  id              String   @id @default(cuid())
  ticketNumber    String   @unique
  resourceId      String
  resource        Resource @relation(fields: [resourceId], references: [id])
  
  status          String   // OPEN, IN_PROGRESS, AWAITING_PARTS, DONE, RETURNED
  priority        String   // LOW, MEDIUM, HIGH, CRITICAL
  
  // Problema
  damageType      String   // STRUCTURAL, EQUIPMENT, COSMETIC, OTHER
  severity        String   // LOW, MEDIUM, HIGH, CRITICAL
  description     String
  photos          String?  // JSON array de URLs
  
  // Atribuição
  reportedById    String
  reportedBy      User     @relation("MaintenanceReporter", fields: [reportedById], references: [id])
  assignedToId    String?
  assignedTo      User?    @relation("MaintenanceAssignee", fields: [assignedToId], references: [id])
  
  // Custos e tempo
  estimatedCost   Float?
  actualCost      Float?
  estimatedDuration Int?   // horas
  actualDuration    Int?
  
  // Workflow
  openedAt        DateTime @default(now())
  startedAt       DateTime?
  completedAt     DateTime?
  returnedToServiceAt DateTime?
  
  // Timeline (JSON)
  timeline        String?  // JSON array de eventos
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([resourceId])
  @@index([status])
  @@index([priority])
  @@map("maintenance_tickets")
}

// ════════════════════════════════════════════════════════════════
// MÓDULO DE VOLUNTARIADO (EXPANDIDO)
// ════════════════════════════════════════════════════════════════

// Tarefas de voluntariado
model VolunteerTask {
  id              String   @id @default(cuid())
  taskNumber      String   @unique
  
  title           String
  description     String
  category        String   // MIDIA, STORE, LIMPEZA, MANUTENCAO, TREINAMENTO, ATENDIMENTO
  
  // Localização
  location        String   @default("CLUB") // CLUB, REMOTE
  specificLocation String?
  
  // Timing
  deadline        DateTime
  estimatedHours  Int    // horas
  hoursWorked     Int?
  
  // Atribuição
  assignedToId    String?
  assignedTo      User?    @relation("TasksAssigned", fields: [assignedToId], references: [id])
  createdById     String
  createdBy       User     @relation("TasksCreated", fields: [createdById], references: [id])
  assignedAt      DateTime @default(now())
  
  // Status
  status          String   // OPEN, ASSIGNED, ACCEPTED, IN_PROGRESS, PENDING_REVIEW, COMPLETED, REJECTED, CANCELLED
  
  // Execução
  startedAt       DateTime?
  submittedAt     DateTime?
  completedAt     DateTime?
  
  // Evidências
  submissionNotes String?
  submissionPhotos String? // JSON array
  submissionFiles  String? // JSON array
  
  // Review
  reviewedById    String?
  reviewedBy      User?    @relation("TasksReviewed", fields: [reviewedById], references: [id])
  reviewedAt      DateTime?
  reviewNotes     String?
  reviewRating    Int?     // 1-5
  
  // Checklist (JSON)
  checklist       String?
  
  // Gamificação
  pointsAwarded   Int?
  
  // Metadata
  priority        String   // LOW, MEDIUM, HIGH, URGENT
  tags            String?  // JSON array
  requiredTalents String?  // JSON array
  maxVolunteers   Int      @default(1)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([assignedToId, status])
  @@index([status])
  @@index([deadline])
  @@map("volunteer_tasks")
}

// Disponibilidade semanal do voluntário
model VolunteerAvailability {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation("VolunteerAvailability", fields: [userId], references: [id], onDelete: Cascade)
  
  dayOfWeek       Int      // 0-6 (0=domingo)
  startTime       String   // "09:00"
  endTime         String   // "12:00"
  
  areas           String   // JSON array de VolunteerArea
  isRemote        Boolean  @default(false)
  
  isActive        Boolean  @default(true)
  notes           String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([userId, dayOfWeek])
  @@map("volunteer_availability")
}

// Reputação do voluntário
model VolunteerReputation {
  id              String   @id @default(cuid())
  userId          String   @unique
  user            User     @relation("VolunteerReputation", fields: [userId], references: [id], onDelete: Cascade)
  
  // Métricas brutas
  totalTasksAssigned   Int @default(0)
  totalTasksCompleted  Int @default(0)
  totalTasksApproved   Int @default(0)
  totalTasksRejected   Int @default(0)
  totalTasksCancelled  Int @default(0)
  totalHours           Float @default(0)
  
  // Taxas (calculadas)
  completionRate  Float @default(0)
  approvalRate    Float @default(0)
  onTimeRate      Float @default(0)
  
  // Tempo médio
  avgResponseTime Float @default(0)  // horas
  avgCompletionTime Float @default(0)
  
  // Feedback
  avgRating       Float @default(0)
  totalFiveStars  Int   @default(0)
  
  // Pontuação global
  reputationScore Int   @default(50)  // 0-100
  reputationLevel String @default("REGULAR") // CRITICAL, REGULAR, BOA, EXCELENTE
  reliabilityScore Int   @default(100)
  
  lastUpdatedAt   DateTime @default(now())
  
  @@map("volunteer_reputation")
}

// Banco de talentos
model VolunteerTalent {
  id              String   @id @default(cuid())
  userId          String   @unique
  user            User     @relation("VolunteerTalent", fields: [userId], references: [id], onDelete: Cascade)
  
  // Habilidades (JSON arrays)
  mediaSkills     String?
  technicalSkills String?
  eventSkills     String?
  otherSkills     String?
  
  // Links
  portfolioUrl    String?
  instagramHandle String?
  linkedinUrl     String?
  
  // Preferências
  preferredAreas  String?  // JSON array
  canLead         Boolean  @default(false)
  canTeach        Boolean  @default(false)
  
  // Equipamentos
  hasOwnEquipment Boolean  @default(false)
  equipmentList   String?  // JSON array
  
  updatedAt       DateTime @updatedAt
  
  @@map("volunteer_talents")
}

model VolunteerTermAcceptance {
  id                  String   @id @default(cuid())
  userId              String   @unique
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  termVersion         String
  termHash            String
  termContentSnapshot String
  acceptedAt          DateTime @default(now())
  ipAddress           String
  userAgent           String
  areas               String   // JSON stringified
  availability        String   // JSON stringified
  status              String   @default("ACTIVE")
  
  @@map("volunteer_term_acceptances")
}

// ════════════════════════════════════════════════════════════════
// PROGRESSÃO DE BARCOS
// ════════════════════════════════════════════════════════════════

model UserBoatUnlock {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  boatType    String   // TANQUE, CANOE, DOUBLE_CANOE, OITO, FOUR_SKIFF, QUATRO_SEM, DOUBLE_SKIFF, SINGLE_SKIFF, DOIS_SEM
  unlockedAt  DateTime @default(now())
  
  // Como foi desbloqueado
  unlockedBy  String   @default("CRITERIA") // CRITERIA, COACH_APPROVAL, ADMIN
  
  @@unique([userId, boatType])
  @@index([userId])
  @@map("user_boat_unlocks")
}
